module.exports=function(e){var t={};function o(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(s,n,function(t){return e[t]}.bind(null,n));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t){e.exports=require("vscode")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o(0),n=o(2),a=o(5);class r{constructor(e){this.context=e}start(){return void 0!==s.workspace.rootPath}attachCommands(){console.log(22222);let e=s.commands.registerCommand("extension.flutterautoimport",function(){let e=[],t=n.ImportDb.all();for(let o=0;o<t.length;o++){let s=t[o];e.push({label:s.name,description:s.name,detail:s.file.path})}s.window.showQuickPick(e,{ignoreFocusOut:!0,matchOnDescription:!0,matchOnDetail:!0,placeHolder:"选择要引入的库？"}).then(function(e){var t=e.detail;if(t.indexOf("lib")>=0){var o=t.split("lib"),n=o[0].split("/"),a="import 'package:"+n[n.length-2]+o[1]+"';\n";let e=new s.WorkspaceEdit;console.log(s.window.activeTextEditor.document.uri,new s.Position(0,0),a),e.insert(s.window.activeTextEditor.document.uri,new s.Position(0,0),a),s.workspace.applyEdit(e)}console.log()})}),t=s.commands.registerCommand("extension.importScan",e=>{let t=new a.ImportScanner(s.workspace.getConfiguration("autoimport"));e.showOutput?t.scan(e):e.edit?t.edit(e):e.delete&&t.delete(e)});r.statusBar=s.window.createStatusBarItem(s.StatusBarAlignment.Left,1),r.statusBar.text="{--} : Scanning.. ",r.statusBar.show(),this.context.subscriptions.push(t,e,r.statusBar)}attachFileWatcher(){if(!0===s.workspace.workspaceFolders.length>0)s.workspace.workspaceFolders.forEach(e=>{let t=s.workspace.getConfiguration("autoimport").get("filesToScan");const o=new s.RelativePattern(e,t);let n=s.workspace.createFileSystemWatcher(o);n.onDidChange(t=>{console.log("multiWorkspace change"),s.commands.executeCommand("extension.importScan",{workspace:e,file:t,edit:!0})}),n.onDidCreate(t=>{console.log("multiWorkspace create"),s.commands.executeCommand("extension.importScan",{workspace:e,file:t,edit:!0})}),n.onDidDelete(t=>{console.log("multiWorkspace delete"),s.commands.executeCommand("extension.importScan",{workspace:e,file:t,delete:!0})})});else{let e=s.workspace.getConfiguration("autoimport").get("filesToScan"),t=s.workspace.createFileSystemWatcher(e),o=void 0;t.onDidChange(e=>{console.log("singleWorkspace change"),s.commands.executeCommand("extension.importScan",{workspace:o,file:e,edit:!0})}),t.onDidCreate(e=>{console.log("singleWorkspace create"),s.commands.executeCommand("extension.importScan",{workspace:o,file:e,edit:!0})}),t.onDidDelete(e=>{console.log("singleWorkspace delete"),s.commands.executeCommand("extension.importScan",{workspace:o,file:e,delete:!0})})}}scanIfRequired(){let e=this.context.workspaceState.get("auto-import-settings");void 0===e||e.firstRun;s.workspace.getConfiguration("autoimport").get("showNotifications")&&s.window.showInformationMessage("[AutoImport] Building cache"),!0===s.workspace.workspaceFolders.length>0?s.workspace.workspaceFolders.forEach(e=>{s.commands.executeCommand("extension.importScan",{workspace:e,showOutput:!0})}):s.commands.executeCommand("extension.importScan",{showOutput:!0}),e.firstRun=!0,this.context.workspaceState.update("auto-import-settings",e)}static setStatusBar(){r.statusBar.text=`{..} : ${n.ImportDb.count}`}}t.AutoImport=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o(0);class n{static get count(){return n.imports.length}static all(){return n.imports}static getImport(e,t){let o=s.workspace.getWorkspaceFolder(t),a=t=>t.name===e;return void 0!==o&&(a=(t=>t.name===e&&t.workspace.name===o.name)),n.imports.filter(a)}static delete(e){try{let t=n.imports.findIndex(t=>t.file.fsPath===e.file.fsPath);-1!==t&&n.imports.splice(t,1)}catch(e){}}static saveImport(e,t,o,s){if(""===(e=e.trim())||1===e.length)return;let a={name:e,file:o,workspace:s};-1===n.imports.findIndex(e=>e.name===a.name&&e.file.fsPath===o.fsPath)&&n.imports.push(a)}}n.imports=new Array,t.ImportDb=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o(4),n=o(1);t.activate=function(e){try{void 0===e.workspaceState.get("auto-import-settings")&&e.workspaceState.update("auto-import-settings",{});let t=new n.AutoImport(e);if(!t.start())return;t.attachCommands(),t.attachFileWatcher(),t.scanIfRequired()}catch(e){s.ErrorHelper.handle(e)}},t.deactivate=function(){}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ErrorHelper=class{static handle(e){console.log(e)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=o(6),n=o(0),a=o(2),r=o(1);t.ImportScanner=class{constructor(e){this.config=e,this.filesToScan=this.config.get("filesToScan"),this.showNotifications=this.config.get("showNotifications")}scan(e){this.showOutput=!!e.showOutput&&e.showOutput,this.showOutput&&(this.scanStarted=new Date);let t=this.filesToScan;void 0!==e.workspace&&(t=new n.RelativePattern(e.workspace.uri.path+"/lib",t)),n.workspace.findFiles(t,"**/node_modules/**",99999).then(e=>{this.processWorkspaceFiles(e)})}edit(e){a.ImportDb.delete(e),this.loadFile(e.file,e.workspace,!0)}delete(e){a.ImportDb.delete(e),r.AutoImport.setStatusBar()}processWorkspaceFiles(e){let t=e;t.forEach((e,o)=>{let s=n.workspace.getWorkspaceFolder(e);this.loadFile(e,s,o===t.length-1)})}loadFile(e,t,o){~e.fsPath.indexOf("main.dart")||s.readFile(e.fsPath,"utf8",(s,a)=>{if(s)return console.log(s);if(this.processFile(a,e,t),o&&r.AutoImport.setStatusBar(),o&&this.showOutput&&this.showNotifications){this.scanEnded=new Date;let e=`[AutoImport] cache creation complete - (${Math.abs(this.scanStarted-this.scanEnded)}ms)`;n.window.showInformationMessage(e)}})}processFile(e,t,o){var s=e.match(/(class) ([a-zA-Z])+/g),n=e.match(/(enum) ([a-zA-Z])+/g);s&&s.forEach(s=>{let n=s.replace("class ","");a.ImportDb.saveImport(n,e,t,o)}),n&&n.forEach(s=>{let n=s.replace("enum ","");a.ImportDb.saveImport(n,e,t,o)})}}},function(e,t){e.exports=require("fs")}]);
//# sourceMappingURL=extension.js.map